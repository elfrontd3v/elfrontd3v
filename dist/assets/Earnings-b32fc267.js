import{R as K,r as c,A as W,T as F,j as e,g as X,f as R,m as y,C as A,S as J,B as w}from"./index-13de64b0.js";import{H as Q}from"./HeaderSection-49e6ff6c.js";import{E as S}from"./EarningsService-7a2445c6.js";import{P as C}from"./constants-2eb86850.js";import{n,M as Z,I as ee,E as te,G as D,C as ae,B as le,P as se,L as re,a as oe,p as ie}from"./GraphicsCard-ab3dd803.js";import{v as P,D as de,P as ne}from"./v4-f882e75d.js";import{T as _,S as L,D as ue}from"./DataTable-7193cf39.js";import{R as U}from"./row-adcb8862.js";import{F as x}from"./index-6d88a5f6.js";import{I as ce}from"./index-06a89f92.js";import{I as O}from"./index-4ea5b18b.js";import"./index-dbd3cd39.js";import"./statusUtils-7353cd91.js";class p extends K.Component{constructor(t){super(t),this.state={id:t!=null&&t.id?t.id:"",uid:t!=null&&t.uid?t.uid:"",name:t!=null&&t.name?t.name:"",periodicity:t!=null&&t.periodicity?t.periodicity:"",periodicityValue:t!=null&&t.periodicityValue?t.periodicityValue:0,value:t!=null&&t.value?t.value:0,monthValue:t!=null&&t.monthValue?t.monthValue:0,dayValue:t!=null&&t.dayValue?t.dayValue:0,yearValue:t!=null&&t.yearValue?t.yearValue:0}}}const me=()=>{const[r]=c.useContext(W),[t]=c.useContext(F),{generalDictionary:s}=t,[V,h]=c.useState([]),[u,o]=c.useState(!1),[f,j]=c.useState({totalEarnings:0,totalEarningsValue:0,maxEarning:0,minEarning:0}),[i,v]=c.useState(!1),[G,N]=c.useState({state:!1,visualize:!1}),[Y,T]=c.useState({...new p(null).state});let k=P();c.useEffect(()=>{r!=null&&r.uid&&b()},[r==null?void 0:r.uid]);const b=()=>{o(!0),S.getAllEarningsByUid(r.uid).then(a=>{const l=[];a==null||a.forEach(d=>{l.push(d.data())}),z(l),h(l),o(!1)}).catch(a=>{console.error(a),o(!1)})},z=a=>{const l=a.length;let d=0,E=0,m=a.length>0?a[0].monthValue:0;a==null||a.forEach(I=>{d=parseFloat(+d+ +I.monthValue),parseFloat(I.monthValue)>E&&(E=I.monthValue),parseFloat(I.monthValue)<m&&(m=I.monthValue)}),j({totalEarnings:l,totalEarningsValue:d,maxEarning:E,minEarning:m})},$=()=>{N({state:!0,visualize:!1}),T({...new p(null).state})},M=()=>{k=P(),N({state:!1,visualize:!1}),T({...new p(null).state})},H=a=>{S.deleteEarning(a).then(l=>{l?(y.success(s.ENDPOINT_DELETE,.5),b()):y.warning(s.ENDPOINT_WARNING,.5)}).catch(l=>{y.error(s.ENDPOINT_ERROR,.5),console.error(l)})},B=(a,l)=>{v(!0);const d=g(a);let E;l&&l.id?E=new p({...l,...d}).state:E=new p({...d,id:k,uid:r.uid}).state,S.insertEarning(E).then(m=>{m&&m.id?(M(),b(),y.success(l?s.ENDPOINT_UPDATE_OK:s.ENDPOINT_INSERT_OK,.5)):y.warning(s.ENDPOINT_WARNING,.5),v(!1)}).catch(m=>{v(!1),console.error("error:",m),y.error(s.ENDPOINT_ERROR,.5)})},g=a=>{const l=a.periodicity,d=parseFloat(a.value/C[l]);return{name:a.name,periodicity:l,periodicityValue:C[l],value:a.value,dayValue:d.toFixed(0),monthValue:(d*C.monthValue).toFixed(0),yearValue:(d*C.yearValue).toFixed(0)}},q=[{title:s.NAME,dataIndex:"name",key:"name",elipsis:!0,sorter:(a,l)=>a.name.localeCompare(l.name),showSorterTooltip:!1},{title:s.PERIODICITY,dataIndex:"periodicity",key:"periodicity",elipsis:!0,responsive:["sm"],render:a=>{let l;switch(a){case"dayValue":l=s.DAILY;break;case"monthValue":l=s.MONTHLY;break;case"yearValue":l=s.ANNUAL;break;default:l=a;break}return e.jsx("span",{children:l})},onFilter:(a,l)=>l.periodicity.indexOf(a)===0,filters:[{text:s.DAILY,value:"dayValue"},{text:s.MONTHLY,value:"monthValue"},{text:s.ANNUAL,value:"yearValue"}]},{title:s.VALUE,dataIndex:"value",key:"value",elipsis:!0,render:a=>e.jsx("span",{children:" $ "+n(a)}),sorter:(a,l)=>a.value-l.value,showSorterTooltip:!1,responsive:["sm"]},{title:s.MONTH_VALUE,dataIndex:"monthValue",key:"monthValue",elipsis:!0,render:a=>e.jsx("span",{children:" $ "+n(a)}),sorter:(a,l)=>a.monthValue-l.monthValue,showSorterTooltip:!1,responsive:["md"]},{title:s.DAY_VALUE,dataIndex:"dayValue",key:"dayValue",elipsis:!0,render:a=>e.jsx("span",{children:" $ "+n(a)}),sorter:(a,l)=>a.dayValue-l.dayValue,showSorterTooltip:!1,responsive:["lg"]},{title:s.YEAR_VALUE,dataIndex:"yearValue",key:"yearValue",elipsis:!0,render:a=>e.jsx("span",{children:" $ "+n(a)}),sorter:(a,l)=>a.yearValue-l.yearValue,showSorterTooltip:!1,responsive:["lg"]},{title:s.ACTIONS,key:"action",width:"10%",elipsis:!1,render:a=>{const{ModalAlertMessageFunction:l}=Z({okText:s.DELETE,title:s.DELETE,description:s.SURE_DELETE_EARNING,okParams:a.id,okHandle:H});return e.jsxs(X,{size:"small",children:[e.jsx(R,{title:s.SEE_DETAIL,children:e.jsx(_,{color:"blue",children:e.jsx(ee,{onClick:()=>{T({...new p(a).state}),N({state:!0,visualize:!0})}})})}),e.jsx(R,{title:s.EDIT,children:e.jsx(_,{color:"green",children:e.jsx(te,{onClick:()=>{T({...new p(a).state}),N({state:!0,visualize:!1})}})})}),e.jsx(R,{title:s.DELETE,children:e.jsx(_,{color:"red",children:e.jsx(de,{onClick:l})})})]})}}];return{generalDictionary:s,loading:u,earningsList:V,columns:q,graphicsData:f,modal:{modalVisible:G,earningToEdit:Y,loadingModal:i,handleCancel:M,handleCreate:B,handleOpenModal:$}}},xe=({graphicsData:r,generalDictionary:t})=>e.jsx(e.Fragment,{children:e.jsxs(U,{gutter:[16,16],children:[e.jsx(A,{xs:24,sm:12,md:12,lg:12,xl:6,xxl:6,children:e.jsx(D,{color:"dark",icon:e.jsx(ae,{}),title:t.NUMBER_OF_EARNINGS,data:r.totalEarnings})}),e.jsx(A,{xs:24,sm:12,md:12,lg:12,xl:6,xxl:6,children:e.jsx(D,{color:"primary",icon:e.jsx(le,{}),title:t.TOTAL_EARNINGS,data:" $ "+n(r.totalEarningsValue)})}),e.jsx(A,{xs:24,sm:12,md:12,lg:12,xl:6,xxl:6,children:e.jsx(D,{color:"success",icon:e.jsx(se,{}),title:t.MAX_EARNING,data:" $ "+n(r.maxEarning)})}),e.jsx(A,{xs:24,sm:12,md:12,lg:12,xl:6,xxl:6,children:e.jsx(D,{color:"warning",icon:e.jsx(re,{}),title:t.MIN_EARNING,data:" $ "+n(r.minEarning)})})]})}),he=({isVisible:r,expenseToEdit:t,handleCancel:s,handleCreate:V,loadingModal:h})=>{const[u]=c.useContext(F),{generalDictionary:o}=u,f=t.id?t:null,j={nameRules:[{required:!0,type:"string",min:3,max:30,message:o.VALIDATE_NAME}],valueRules:[{transform:i=>parseFloat(i),required:!0,type:"number",min:1,max:999999999999,message:o.VALIDATE_VALUE}],periodicityRules:[{required:!0,message:o.VALIDATE_PERIODICITY}]};return e.jsx(oe,{closable:!1,destroyOnClose:!0,maskClosable:!1,title:o.ADD_EARNING,open:r.state,onCancel:s,footer:null,children:e.jsx(J,{tip:o.SAVING,spinning:h,delay:500,size:"large",children:e.jsx(U,{children:e.jsx(A,{span:24,children:e.jsxs(x,{initialValues:f,labelCol:{span:8},wrapperCol:{span:15},onFinish:i=>V(i,f||null),children:[e.jsx(x.Item,{name:"name",label:o.NAME,rules:j.nameRules,hasFeedback:!0,children:e.jsx(ce,{disabled:r.visualize,type:"text",placeholder:o.NAME})}),e.jsx(x.Item,{name:"value",label:o.VALUE,rules:j.valueRules,hasFeedback:!0,children:e.jsx(O,{disabled:r.visualize,prefix:"$",style:{width:"100%"},controls:!1,formatter:i=>n(i),parser:i=>ie(i)})}),e.jsx(x.Item,{name:"periodicity",label:o.PERIODICITY,rules:j.periodicityRules,hasFeedback:!0,children:e.jsxs(L,{placeholder:o.PERIODICITY,disabled:r.visualize,children:[e.jsx(L.Option,{value:"monthValue",children:o.MONTHLY}),e.jsx(L.Option,{value:"dayValue",children:o.DAILY}),e.jsx(L.Option,{value:"yearValue",children:o.ANNUAL})]})}),r.visualize&&e.jsxs(e.Fragment,{children:[e.jsx(x.Item,{name:"dayValue",label:o.DAY_VALUE,children:e.jsx(O,{disabled:!0,prefix:"$",style:{width:"100%"},controls:!1,formatter:i=>n(i)})}),e.jsx(x.Item,{name:"monthValue",label:o.MONTH_VALUE,children:e.jsx(O,{disabled:!0,prefix:"$",style:{width:"100%"},controls:!1,formatter:i=>n(i)})}),e.jsx(x.Item,{name:"yearValue",label:o.YEAR_VALUE,children:e.jsx(O,{disabled:!0,prefix:"$",style:{width:"100%"},controls:!1,formatter:i=>n(i)})})]}),e.jsxs(x.Item,{wrapperCol:24,style:{textAlign:"center",marginTop:"10px"},children:[!r.visualize&&e.jsx(w,{type:"primary",htmlType:"submit",style:{marginRight:"8px"},disabled:h,children:o.ACCEPT}),e.jsx(w,{type:"default",onClick:s,disabled:h,children:o.CANCEL})]})]})})})})})};const Oe=()=>{const{generalDictionary:r,loading:t,earningsList:s,columns:V,graphicsData:h,modal:u}=me();return e.jsxs(e.Fragment,{children:[e.jsx(Q,{title:r.EARNINGS,buttons:[e.jsx(w,{type:"primary",icon:e.jsx(ne,{}),onClick:u.handleOpenModal,children:r.ADD},"1")]}),e.jsx(xe,{generalDictionary:r,graphicsData:h}),e.jsx(ue,{id:"earnings-table",loading:t,dataSource:s,columns:V,title:r.EARNINGS_LIST,color:"success"}),e.jsx(he,{isVisible:u.modalVisible,expenseToEdit:u.earningToEdit,handleCancel:u.handleCancel,handleCreate:u.handleCreate,loadingModal:u.loadingModal})]})};export{Oe as default};
