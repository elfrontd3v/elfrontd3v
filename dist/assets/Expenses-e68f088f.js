import{R as q,r as c,A as K,T as R,j as e,g as W,f as v,m as p,C as T,S as J,B as _}from"./index-13de64b0.js";import{T as b,S as g,D as Q}from"./DataTable-7193cf39.js";import{H as Z}from"./HeaderSection-49e6ff6c.js";import{E as P}from"./ExpensesService-6eb2a69f.js";import{P as C}from"./constants-2eb86850.js";import{n as d,M as ee,I as te,E as ae,G as D,C as le,B as re,P as se,L as ie,a as oe,p as ne}from"./GraphicsCard-ab3dd803.js";import{v as M,D as de,P as ue}from"./v4-f882e75d.js";import{R as F}from"./row-adcb8862.js";import{F as E}from"./index-6d88a5f6.js";import{I as ce}from"./index-06a89f92.js";import{I as L}from"./index-4ea5b18b.js";import"./index-dbd3cd39.js";import"./statusUtils-7353cd91.js";class y extends q.Component{constructor(t){super(t),this.state={id:t!=null&&t.id?t.id:"",uid:t!=null&&t.uid?t.uid:"",name:t!=null&&t.name?t.name:"",periodicity:t!=null&&t.periodicity?t.periodicity:"",periodicityValue:t!=null&&t.periodicityValue?t.periodicityValue:0,value:t!=null&&t.value?t.value:0,monthValue:t!=null&&t.monthValue?t.monthValue:0,dayValue:t!=null&&t.dayValue?t.dayValue:0,yearValue:t!=null&&t.yearValue?t.yearValue:0}}}const me=()=>{const[s]=c.useContext(K),[t]=c.useContext(R),{generalDictionary:r}=t,[V,h]=c.useState([]),[u,i]=c.useState(!0),[j,f]=c.useState({totalExpenses:0,totalExpensesValue:0,maxExpense:0,minExpense:0}),[o,O]=c.useState(!1),[U,A]=c.useState({state:!1,visualize:!1}),[Y,N]=c.useState({...new y(null).state});let w=M();c.useEffect(()=>{s!=null&&s.uid&&S()},[s==null?void 0:s.uid]);const S=()=>{i(!0),P.getAllExpensesByUid(s.uid).then(a=>{const l=[];a.forEach(n=>{l.push(n.data())}),z(l),h(l),i(!1)}).catch(a=>{console.error(a),i(!1)})},z=a=>{const l=a.length;let n=0,x=0,m=a.length>0?a[0].monthValue:0;a==null||a.forEach(I=>{n=parseFloat(+n+ +I.monthValue),parseFloat(I.monthValue)>x&&(x=I.monthValue),parseFloat(I.monthValue)<m&&(m=I.monthValue)}),f({totalExpenses:l,totalExpensesValue:n,maxExpense:x,minExpense:m})},k=()=>{w=M(),A({state:!1,visualize:!1}),N({...new y(null).state})},$=()=>{A({state:!0,visualize:!1}),N({...new y(null).state})},H=(a,l)=>{O(!0);const n=X(a);let x;l&&l.id?x=new y({...l,...n}).state:x=new y({...n,id:w,uid:s.uid}).state,P.insertExpense(x).then(m=>{m&&m.id?(k(),S(),p.success(l?r.ENDPOINT_UPDATE_OK:r.ENDPOINT_INSERT_OK,.5)):p.warning(r.ENDPOINT_WARNING,.5),O(!1)}).catch(m=>{O(!1),console.error("error:",m),p.error(r.ENDPOINT_ERROR,.5)})},X=a=>{const l=a.periodicity,n=parseFloat(a.value/C[l]);return{name:a.name,periodicity:l,periodicityValue:C[l],value:a.value,dayValue:n.toFixed(0),monthValue:(n*C.monthValue).toFixed(0),yearValue:(n*C.yearValue).toFixed(0)}},G=a=>{P.deleteExpense(a).then(l=>{l?(p.success(r.ENDPOINT_DELETE,.5),S()):p.warning(r.ENDPOINT_WARNING,.5)}).catch(l=>{p.error(r.ENDPOINT_ERROR,.5),console.error(l)})},B=[{title:r.NAME,dataIndex:"name",key:"name",align:"center",ellipsis:!0,sorter:(a,l)=>a.name.localeCompare(l.name),showSorterTooltip:!1},{title:r.PERIODICITY,dataIndex:"periodicity",key:"periodicity",align:"center",ellipsis:!0,responsive:["sm"],render:a=>{let l;switch(a){case"dayValue":l=r.DAILY;break;case"monthValue":l=r.MONTHLY;break;case"yearValue":l=r.ANNUAL;break;default:l=a;break}return e.jsx("span",{children:l})},onFilter:(a,l)=>l.periodicity.indexOf(a)===0,filters:[{text:r.DAILY,value:"dayValue"},{text:r.MONTHLY,value:"monthValue"},{text:r.ANNUAL,value:"yearValue"}]},{title:r.VALUE,dataIndex:"value",key:"value",align:"center",ellipsis:!0,render:a=>e.jsx("span",{children:" $ "+d(a)}),sorter:(a,l)=>a.value-l.value,showSorterTooltip:!1,responsive:["sm"]},{title:r.MONTH_VALUE,dataIndex:"monthValue",key:"monthValue",align:"center",ellipsis:!0,render:a=>e.jsx("span",{children:" $ "+d(a)}),sorter:(a,l)=>a.monthValue-l.monthValue,showSorterTooltip:!1,responsive:["md"]},{title:r.DAY_VALUE,dataIndex:"dayValue",key:"dayValue",align:"center",ellipsis:!0,render:a=>e.jsx("span",{children:" $ "+d(a)}),sorter:(a,l)=>a.dayValue-l.dayValue,showSorterTooltip:!1,responsive:["lg"]},{title:r.YEAR_VALUE,dataIndex:"yearValue",key:"yearValue",align:"center",ellipsis:!0,render:a=>e.jsx("span",{children:" $ "+d(a)}),sorter:(a,l)=>a.yearValue-l.yearValue,showSorterTooltip:!1,responsive:["lg"]},{title:r.ACTIONS,key:"action",width:"10%",align:"center",ellipsis:!0,render:a=>{const{ModalAlertMessageFunction:l}=ee({okText:r.DELETE,title:r.DELETE,description:r.SURE_DELETE_EXPENSE,okParams:a.id,okHandle:G});return e.jsxs(W,{size:"small",children:[e.jsx(v,{title:r.SEE_DETAIL,children:e.jsx(b,{color:"blue",children:e.jsx(te,{onClick:()=>{N({...new y(a).state}),A({state:!0,visualize:!0})}})})}),e.jsx(v,{title:r.EDIT,children:e.jsx(b,{color:"green",children:e.jsx(ae,{onClick:()=>{N({...new y(a).state}),A({state:!0,visualize:!1})}})})}),e.jsx(v,{title:r.DELETE,children:e.jsx(b,{color:"red",children:e.jsx(de,{onClick:l})})})]})}}];return{generalDictionary:r,loading:u,expensesList:V,columns:B,graphicsData:j,modal:{modalVisible:U,expenseToEdit:Y,loadingModal:o,handleCancel:k,handleCreate:H,handleOpenModal:$}}},Ee=({graphicsData:s,generalDictionary:t})=>e.jsx(e.Fragment,{children:e.jsxs(F,{gutter:[16,16],children:[e.jsx(T,{xs:24,sm:12,md:12,lg:12,xl:6,xxl:6,children:e.jsx(D,{color:"dark",icon:e.jsx(le,{}),title:t.NUMBER_OF_EXPENSES,data:s.totalExpenses})}),e.jsx(T,{xs:24,sm:12,md:12,lg:12,xl:6,xxl:6,children:e.jsx(D,{color:"warning",icon:e.jsx(re,{}),title:t.TOTAL_EXPENSES,data:" $ "+d(s.totalExpensesValue)})}),e.jsx(T,{xs:24,sm:12,md:12,lg:12,xl:6,xxl:6,children:e.jsx(D,{color:"error",icon:e.jsx(se,{}),title:t.MAX_EXPENSE,data:" $ "+d(s.maxExpense)})}),e.jsx(T,{xs:24,sm:12,md:12,lg:12,xl:6,xxl:6,children:e.jsx(D,{color:"primary",icon:e.jsx(ie,{}),title:t.MIN_EXPENSE,data:" $ "+d(s.minExpense)})})]})}),he=({isVisible:s,expenseToEdit:t,handleCancel:r,handleCreate:V,loadingModal:h})=>{const[u]=c.useContext(R),{generalDictionary:i}=u,j=t.id?t:null,f={nameRules:[{required:!0,type:"string",min:3,max:30,message:i.VALIDATE_NAME}],valueRules:[{transform:o=>parseFloat(o),required:!0,type:"number",min:1,max:999999999999,message:i.VALIDATE_VALUE}],periodicityRules:[{required:!0,message:i.VALIDATE_PERIODICITY}]};return e.jsx(oe,{closable:!1,destroyOnClose:!0,maskClosable:!1,title:i.ADD_EXPENSE,open:s.state,onCancel:r,footer:null,children:e.jsx(J,{tip:i.SAVING,spinning:h,delay:500,size:"large",children:e.jsx(F,{children:e.jsx(T,{span:24,children:e.jsxs(E,{initialValues:j,labelCol:{span:8},wrapperCol:{span:15},onFinish:o=>V(o,j||null),children:[e.jsx(E.Item,{name:"name",label:i.NAME,rules:f.nameRules,hasFeedback:!0,children:e.jsx(ce,{disabled:s.visualize,type:"text",placeholder:i.NAME})}),e.jsx(E.Item,{name:"value",label:i.VALUE,rules:f.valueRules,hasFeedback:!0,children:e.jsx(L,{disabled:s.visualize,prefix:"$",style:{width:"100%"},controls:!1,formatter:o=>d(o),parser:o=>ne(o)})}),e.jsx(E.Item,{name:"periodicity",label:i.PERIODICITY,rules:f.periodicityRules,hasFeedback:!0,children:e.jsxs(g,{placeholder:i.PERIODICITY,disabled:s.visualize,children:[e.jsx(g.Option,{value:"monthValue",children:i.MONTHLY}),e.jsx(g.Option,{value:"dayValue",children:i.DAILY}),e.jsx(g.Option,{value:"yearValue",children:i.ANNUAL})]})}),s.visualize&&e.jsxs(e.Fragment,{children:[e.jsx(E.Item,{name:"dayValue",label:i.DAY_VALUE,children:e.jsx(L,{disabled:!0,prefix:"$",style:{width:"100%"},controls:!1,formatter:o=>d(o)})}),e.jsx(E.Item,{name:"monthValue",label:i.MONTH_VALUE,children:e.jsx(L,{disabled:!0,prefix:"$",style:{width:"100%"},controls:!1,formatter:o=>d(o)})}),e.jsx(E.Item,{name:"yearValue",label:i.YEAR_VALUE,children:e.jsx(L,{disabled:!0,prefix:"$",style:{width:"100%"},controls:!1,formatter:o=>d(o)})})]}),e.jsxs(E.Item,{wrapperCol:24,style:{textAlign:"center",marginTop:"10px"},children:[!s.visualize&&e.jsx(_,{type:"primary",htmlType:"submit",style:{marginRight:"8px"},disabled:h,children:i.ACCEPT}),e.jsx(_,{type:"default",onClick:r,disabled:h,children:i.CANCEL})]})]})})})})})};const Le=()=>{const{generalDictionary:s,loading:t,expensesList:r,columns:V,graphicsData:h,modal:u}=me();return e.jsxs(e.Fragment,{children:[e.jsx(Z,{title:s.EXPENSES,buttons:[e.jsx(_,{type:"primary",icon:e.jsx(ue,{}),onClick:u.handleOpenModal,children:s.ADD},"1")]}),e.jsx(Ee,{generalDictionary:s,graphicsData:h}),e.jsx(Q,{id:"expenses-table",loading:t,dataSource:r,columns:V,title:s.EXPENSES_LIST,color:"error"}),e.jsx(he,{isVisible:u.modalVisible,expenseToEdit:u.expenseToEdit,handleCancel:u.handleCancel,handleCreate:u.handleCreate,loadingModal:u.loadingModal})]})};export{Le as default};
